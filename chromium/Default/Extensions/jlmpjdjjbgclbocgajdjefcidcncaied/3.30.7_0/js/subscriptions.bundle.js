"use strict";(self.webpackChunkextension=self.webpackChunkextension||[]).push([[9841],{28893:(e,n,o)=>{o.r(n),o.d(n,{createSubscriptionClient:()=>g});const t=Object.prototype.hasOwnProperty;function r(e){return"object"==typeof e&&null!==e}function i(e,n){return t.call(e,n)}function a(e,n){return t.call(e,n)&&r(e[n])}function s(e,n){return t.call(e,n)&&"string"==typeof e[n]}function c(e,n){return e.length<124?e:n}const l="graphql-transport-ws";var d,u;function p(e){if(r(e)){if(!s(e,"type"))return!1;switch(e.type){case u.ConnectionInit:case u.ConnectionAck:case u.Ping:case u.Pong:return!i(e,"payload")||void 0===e.payload||r(e.payload);case u.Subscribe:return s(e,"id")&&a(e,"payload")&&(!i(e.payload,"operationName")||void 0===e.payload.operationName||null===e.payload.operationName||"string"==typeof e.payload.operationName)&&s(e.payload,"query")&&(!i(e.payload,"variables")||void 0===e.payload.variables||null===e.payload.variables||a(e.payload,"variables"))&&(!i(e.payload,"extensions")||void 0===e.payload.extensions||null===e.payload.extensions||a(e.payload,"extensions"));case u.Next:return s(e,"id")&&a(e,"payload");case u.Error:return s(e,"id")&&(n=e.payload,Array.isArray(n)&&n.length>0&&n.every((e=>"message"in e)));case u.Complete:return s(e,"id");default:return!1}}var n;return!1}function y(e,n){if(!p(e))throw new Error("Cannot stringify invalid message");return JSON.stringify(e,n)}function m(e){const{url:n,connectionParams:o,lazy:t=!0,onNonLazyError:r=console.error,lazyCloseTimeout:i=0,keepAlive:a=0,disablePong:s,connectionAckWaitTimeout:m=0,retryAttempts:g=5,retryWait:b=async function(e){let n=1e3;for(let o=0;o<e;o++)n*=2;await new Promise((e=>setTimeout(e,n+Math.floor(2700*Math.random()+300))))},isFatalConnectionProblem:w=(e=>!f(e)),on:x,webSocketImpl:v,generateID:h=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const n=16*Math.random()|0;return("x"==e?n:3&n|8).toString(16)}))},jsonMessageReplacer:C,jsonMessageReviver:S}=e;let E;if(v){if(!("function"==typeof(k=v)&&"constructor"in k&&"CLOSED"in k&&"CLOSING"in k&&"CONNECTING"in k&&"OPEN"in k))throw new Error("Invalid WebSocket implementation provided");E=v}else"undefined"!=typeof WebSocket?E=WebSocket:"undefined"!=typeof global?E=global.WebSocket||global.MozWebSocket:"undefined"!=typeof window&&(E=window.WebSocket||window.MozWebSocket);var k;if(!E)throw new Error("WebSocket implementation missing");const I=E,N=(()=>{const e=(()=>{const e={};return{on:(n,o)=>(e[n]=o,()=>{delete e[n]}),emit(n){var o;"id"in n&&(null===(o=e[n.id])||void 0===o||o.call(e,n))}}})(),n={connecting:(null==x?void 0:x.connecting)?[x.connecting]:[],opened:(null==x?void 0:x.opened)?[x.opened]:[],connected:(null==x?void 0:x.connected)?[x.connected]:[],ping:(null==x?void 0:x.ping)?[x.ping]:[],pong:(null==x?void 0:x.pong)?[x.pong]:[],message:(null==x?void 0:x.message)?[e.emit,x.message]:[e.emit],closed:(null==x?void 0:x.closed)?[x.closed]:[],error:(null==x?void 0:x.error)?[x.error]:[]};return{onMessage:e.on,on(e,o){const t=n[e];return t.push(o),()=>{t.splice(t.indexOf(o),1)}},emit(e,...o){for(const t of[...n[e]])t(...o)}}})();function P(e){const n=[N.on("error",(o=>{n.forEach((e=>e())),e(o)})),N.on("closed",(o=>{n.forEach((e=>e())),e(o)}))]}let T,A=0,M=!1,O=0,R=!1;async function W(){const[e,t]=await(null!=T?T:T=new Promise(((e,t)=>(async()=>{if(M){if(await b(O),!A)return T=void 0,t({code:1e3,reason:"All Subscriptions Gone"});O++}N.emit("connecting");const r=new I("function"==typeof n?await n():n,l);let i,f;function g(){isFinite(a)&&a>0&&(clearTimeout(f),f=setTimeout((()=>{r.readyState===I.OPEN&&(r.send(y({type:u.Ping})),N.emit("ping",!1,void 0))}),a))}P((e=>{T=void 0,clearTimeout(i),clearTimeout(f),t(e)})),r.onerror=e=>N.emit("error",e),r.onclose=e=>N.emit("closed",e),r.onopen=async()=>{try{N.emit("opened",r);const e="function"==typeof o?await o():o;r.send(y(e?{type:u.ConnectionInit,payload:e}:{type:u.ConnectionInit},C)),isFinite(m)&&m>0&&(i=setTimeout((()=>{r.close(d.ConnectionAcknowledgementTimeout,"Connection acknowledgement timeout")}),m)),g()}catch(e){N.emit("error",e),r.close(d.InternalClientError,c(e instanceof Error?e.message:new Error(e).message,"Internal client error"))}};let w=!1;r.onmessage=({data:n})=>{try{const o=function(e,n){if(p(e))return e;if("string"!=typeof e)throw new Error("Message not parsable");const o=JSON.parse(e,n);if(!p(o))throw new Error("Invalid message");return o}(n,S);if(N.emit("message",o),"ping"===o.type||"pong"===o.type)return N.emit(o.type,!0,o.payload),void("pong"===o.type?g():s||(r.send(y(o.payload?{type:u.Pong,payload:o.payload}:{type:u.Pong})),N.emit("pong",!1,o.payload)));if(w)return;if(o.type!==u.ConnectionAck)throw new Error(`First message cannot be of type ${o.type}`);clearTimeout(i),w=!0,N.emit("connected",r,o.payload),M=!1,O=0,e([r,new Promise(((e,n)=>P(n)))])}catch(e){r.onmessage=null,N.emit("error",e),r.close(d.BadResponse,c(e instanceof Error?e.message:new Error(e).message,"Bad response"))}}})())));e.readyState===I.CLOSING&&await t;let r=()=>{};const f=new Promise((e=>r=e));return[e,r,Promise.race([f.then((()=>{if(!A){const n=()=>e.close(1e3,"Normal Closure");isFinite(i)&&i>0?setTimeout((()=>{A||e.readyState!==I.OPEN||n()}),i):n()}})),t])]}function q(e){if(f(e)&&(n=e.code,![1e3,1001,1006,1005,1012,1013,1013].includes(n)&&n>=1e3&&n<=1999||[d.InternalServerError,d.InternalClientError,d.BadRequest,d.BadResponse,d.Unauthorized,d.SubprotocolNotAcceptable,d.SubscriberAlreadyExists,d.TooManyInitialisationRequests].includes(e.code)))throw e;var n;if(R)return!1;if(f(e)&&1e3===e.code)return A>0;if(!g||O>=g)throw e;if(w(e))throw e;return M=!0}return t||(async()=>{for(A++;;)try{const[,,e]=await W();await e}catch(e){try{if(!q(e))return}catch(e){return null==r?void 0:r(e)}}})(),{on:N.on,subscribe(e,n){const o=h();let t=!1,r=!1,i=()=>{A--,t=!0};return(async()=>{for(A++;;)try{const[a,s,c]=await W();if(t)return s();const l=N.onMessage(o,(e=>{switch(e.type){case u.Next:return void n.next(e.payload);case u.Error:return r=!0,t=!0,n.error(e.payload),void i();case u.Complete:return t=!0,void i()}}));return a.send(y({id:o,type:u.Subscribe,payload:e},C)),i=()=>{t||a.readyState!==I.OPEN||a.send(y({id:o,type:u.Complete},C)),A--,t=!0,s()},void await c.finally(l)}catch(e){if(!q(e))return}})().then((()=>{r||n.complete()})).catch((e=>{n.error(e)})),()=>{t||i()}},async dispose(){if(R=!0,T){const[e]=await T;e.close(1e3,"Normal Closure")}}}}function f(e){return r(e)&&"code"in e&&"reason"in e}function g(e){return m({url:"wss://subs.daily.dev/graphql",lazy:!1,connectionParams:{token:e}})}!function(e){e[e.InternalServerError=4500]="InternalServerError",e[e.InternalClientError=4005]="InternalClientError",e[e.BadRequest=4400]="BadRequest",e[e.BadResponse=4004]="BadResponse",e[e.Unauthorized=4401]="Unauthorized",e[e.Forbidden=4403]="Forbidden",e[e.SubprotocolNotAcceptable=4406]="SubprotocolNotAcceptable",e[e.ConnectionInitialisationTimeout=4408]="ConnectionInitialisationTimeout",e[e.ConnectionAcknowledgementTimeout=4504]="ConnectionAcknowledgementTimeout",e[e.SubscriberAlreadyExists=4409]="SubscriberAlreadyExists",e[e.TooManyInitialisationRequests=4429]="TooManyInitialisationRequests"}(d||(d={})),function(e){e.ConnectionInit="connection_init",e.ConnectionAck="connection_ack",e.Ping="ping",e.Pong="pong",e.Subscribe="subscribe",e.Next="next",e.Error="error",e.Complete="complete"}(u||(u={}))}}]);